<!DOCTYPE html>
<html lang="en">
    <%- include('./head.ejs') %>
    <body>
        <header></header>
        <%- include('./menu.ejs') %>

        <main class="content-border">
            <%- include('./navigation.ejs') %>

            <div class="content">
                <div class="single">
                    <section id="market-list">
                        <% for (let market of marketStats) { -%>
                            <div class="relax-container market">
                                <h2 class="title">
                                    <span class="flag-<%= market.id %>"></span>
                                    <%= market.id.toUpperCase() %>
                                </h2>
                                <div class="stats">
                                    <ul>
                                        <li><%= formatNumbers(market.players) %> <%= i18n.market_list.players %></li>
                                        <li><%= formatNumbers(market.tribes) %> <%= i18n.market_list.tribes %></li>
                                        <li><%= formatNumbers(market.villages) %> <%= i18n.market_list.villages %></li>
                                    </ul>
                                </div>
                                <div class="worlds">
                                    <ul>
                                        <li><%= sprintf(i18n.market_list.open_worlds, market.openWorld) %></li>
                                        <li><%= sprintf(i18n.market_list.closed_worlds, market.closedWorld) %></li>
                                    </ul>
                                </div>

                                <div class="actions">
                                    <a class="relax-button toggle-list-worlds" href="/stats/<%= market.id %>">World List</a>
                                </div>

                                <div class="world-list hidden">
                                    <% for (const worldState of ['open', 'closed']) { %>
                                        <% if (worldState === 'closed' && worldsByMarket[market.id].closed.length) { %>
                                            <h3>Closed Worlds</h3>
                                        <% } %>

                                        <% for (const [worldNumber, world] of worldsByMarket[market.id][worldState]) { -%>
                                            <div class="relax-sub-container world <%= worldState %>">
                                                <h3 class="title">
                                                    <span class="flag-<%= world.market %>"></span>
                                                    <%= world.name %><sup><%= world.num %></sup>
                                                </h3>

                                                <div class="stats">
                                                    <p><span class="label"><%= formatNumbers(world.player_count) %> <%= i18n.world_list.players %></span></p>
                                                    <p><span class="label"><%= formatNumbers(world.tribe_count) %> <%= i18n.world_list.tribes %></span></p>
                                                    <p><span class="label"><%= formatNumbers(world.village_count) %> <%= i18n.world_list.villages %></span></p>
                                                </div>

                                                <% if (world.config) { -%>
                                                    <div class="settings">
                                                        <p><span class="label"><%= i18n.world_list.setting_world_type %></span> <span class="value"><% __append(world.config.victory_points ? i18n.world_list.world_type_victory_points : i18n.world_list.world_type_domination) %></span></p>
                                                        <p><span class="label"><%= i18n.world_list.setting_troop_relocation %></span> <span class="value"><% __append(world.config.relocate_units ? i18n.world_list.setting_enabled : i18n.world_list.setting_disabled) %></span></p>
                                                    </div>
                                                <% } -%>

                                                <% if (world.open_date || world.close_date) { %>
                                                    <div class="dates">
                                                        <% if (world.open_date) { %>
                                                            <p><span class="label"><%= i18n.world_list.open_date %></span> <span class="value"><%= formatDate(world.open_date, 'day-only') %></span></p>
                                                        <% } %>

                                                        <% if (world.close_date) { %>
                                                            <p><span class="label"><%= i18n.world_list.close_date %></span> <span class="value"><%= formatDate(world.close_date, 'day-only') %></span></p>
                                                        <% } %>
                                                    </div>
                                                <% } %>

                                                <div class="actions">
                                                    <a class="relax-button" href="/stats/<%= world.market %>/<%= world.num %>">Stats</a>
                                                    <a class="relax-button" href="/maps/<%= world.market %>/<%= world.num %>">Map</a>
                                                </div>
                                            </div>
                                        <% } -%>
                                    <% } %>
                                </div>
                            </div>
                        <% } -%>
                    </section>
                </div>
            </div>
        </main>

        <%- include('./footer.ejs') %>

        <script sync type="text/javascript" src="/javascripts/libs/require.min.js"></script>
        <script defer type="text/javascript">define('backendValues', () => (<%- JSON.stringify(backendValues) %>))</script>
        <script defer type="text/javascript" src="/javascripts/utils.js"></script>
        <script defer type="text/javascript" src="/javascripts/homepage.js"></script>
        <script defer type="text/javascript" src="/javascripts/language-selector.js"></script>
    </body>
</html>
